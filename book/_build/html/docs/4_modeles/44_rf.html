
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Random Forest &#8212; G1 - Apprentissage statistique</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Neuronal Network" href="45_rn.html" />
    <link rel="prev" title="CART" href="43_cart.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">G1 - Apprentissage statistique</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1_desc/10_description.html">
   Description des données
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2_prep/20_generale.html">
   Préparation des données
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_mesure/30_mesure.html">
   Mesure
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="40_modeles.html">
   Implémentation des modèles
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="41_logistique.html">
     Logistique
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="42_svc.html">
     Support Vector Classifier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="43_cart.html">
     CART
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Random Forest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="45_rn.html">
     Neuronal Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="46_grad_boost.html">
     Gradient Boosting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="47_xgboost.html">
     XGBoost
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../5_retenu/50_mod_final.html">
   Modèle retenu
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation-sur-r">
   Implémentation sur R
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#telechargement-des-donnees">
   Téléchargement des données
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-processing">
   Pre-processing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementation">
   Implémentation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tuning">
   Tuning
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-1-initialisation">
     Étape 1 : Initialisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-2-n-estimators">
     Étape 2 : n_estimators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-3-max-depth">
     Étape 3 : max_depth
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-4-min-samples-split">
     Étape 4 :min_samples_split
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-5-min-samples-leaf">
     Étape 5 : min_samples_leaf
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-6-min-impurity-decrease">
     Étape 6 : min_impurity_decrease
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-7-n-estimators">
     Étape 7 : n_estimators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-8-max-features">
     Étape 8 : max_features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etape-9-class-weight">
     Étape 9 : class_weight
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#methode-par-algorithme-genetique">
   Méthode par algorithme génétique
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="random-forest">
<h1>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this headline">¶</a></h1>
<div class="section" id="implementation-sur-r">
<h2>Implémentation sur R<a class="headerlink" href="#implementation-sur-r" title="Permalink to this headline">¶</a></h2>
<p>Dans un premier temps, nous souhaitons montrer une implémentation basique d’un random forest sour R. Le tuning se fera par la suite avec Python.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nous utilisons un kernel R pour les cellules suivantes. Chaque cellule n’est pas utilisé avec le même Kernel. Soit R, soit Python.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;https://www.data.mclavier.com/prj_datascience/train_train_r.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">db</span><span class="p">)</span> <span class="o">=</span> <span class="n">db</span><span class="o">$</span><span class="n">ind</span>
<span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="nf">ncol</span><span class="p">(</span><span class="n">db</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 11</caption>
<thead>
	<tr><th></th><th scope=col>Gender</th><th scope=col>Age</th><th scope=col>Driving_License</th><th scope=col>Region_Code</th><th scope=col>Previously_Insured</th><th scope=col>Vehicle_Age</th><th scope=col>Vehicle_Damage</th><th scope=col>Annual_Premium</th><th scope=col>Policy_Sales_Channel</th><th scope=col>Vintage</th><th scope=col>Response</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Female</td><td>22</td><td>1</td><td> 3</td><td>1</td><td>&lt; 1 Year</td><td>No </td><td>29884</td><td>152</td><td>112</td><td>0</td></tr>
	<tr><th scope=row>2</th><td>Female</td><td>60</td><td>1</td><td>28</td><td>0</td><td>1-2 Year</td><td>Yes</td><td>45282</td><td>124</td><td> 87</td><td>0</td></tr>
	<tr><th scope=row>3</th><td>Female</td><td>41</td><td>1</td><td>29</td><td>1</td><td>1-2 Year</td><td>No </td><td>24399</td><td>152</td><td> 52</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dbr</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;https://www.data.mclavier.com/prj_datascience/train_test_r.csv&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span><span class="s">&quot;,&quot;</span> <span class="p">)</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">dbr</span><span class="p">)</span> <span class="o">=</span> <span class="n">dbr</span><span class="o">$</span><span class="n">ind</span>
<span class="n">dbr</span><span class="o">=</span><span class="n">dbr</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="nf">ncol</span><span class="p">(</span><span class="n">dbr</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 11</caption>
<thead>
	<tr><th></th><th scope=col>Gender</th><th scope=col>Age</th><th scope=col>Driving_License</th><th scope=col>Region_Code</th><th scope=col>Previously_Insured</th><th scope=col>Vehicle_Age</th><th scope=col>Vehicle_Damage</th><th scope=col>Annual_Premium</th><th scope=col>Policy_Sales_Channel</th><th scope=col>Vintage</th><th scope=col>Response</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Male  </td><td>31</td><td>1</td><td>11</td><td>0</td><td>1-2 Year</td><td>Yes</td><td> 2630</td><td>124</td><td>271</td><td>1</td></tr>
	<tr><th scope=row>2</th><td>Female</td><td>24</td><td>1</td><td>30</td><td>1</td><td>&lt; 1 Year</td><td>No </td><td>22144</td><td>152</td><td> 88</td><td>0</td></tr>
	<tr><th scope=row>3</th><td>Male  </td><td>42</td><td>1</td><td>29</td><td>0</td><td>1-2 Year</td><td>Yes</td><td>56222</td><td>156</td><td>108</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Nous transformons la variable target en factor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">$</span><span class="n">Response</span> <span class="o">=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">db</span><span class="o">$</span><span class="n">Response</span><span class="p">)</span>
<span class="n">dbr</span><span class="o">$</span><span class="n">Response</span> <span class="o">=</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">dbr</span><span class="o">$</span><span class="n">Response</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Nous importons la librairie <em>randomForest</em></p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Implémentation d’une forêt :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">&lt;-</span> <span class="nf">randomForest</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">Response</span> <span class="o">~</span> <span class="n">.</span><span class="p">,</span> <span class="n">ntree</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span> <span class="n">mtry</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">ncol</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="m">-1</span><span class="p">),</span>
                   <span class="n">nodesize</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span><span class="n">maxnodes</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Prédiction de la base test :</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">xtest</span> <span class="o">=</span> <span class="n">dbr</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="nf">ncol</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="m">-1</span><span class="p">)]</span>
<span class="nf">head</span><span class="p">(</span><span class="n">xtest</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 10</caption>
<thead>
	<tr><th></th><th scope=col>Gender</th><th scope=col>Age</th><th scope=col>Driving_License</th><th scope=col>Region_Code</th><th scope=col>Previously_Insured</th><th scope=col>Vehicle_Age</th><th scope=col>Vehicle_Damage</th><th scope=col>Annual_Premium</th><th scope=col>Policy_Sales_Channel</th><th scope=col>Vintage</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Male  </td><td>31</td><td>1</td><td>11</td><td>0</td><td>1-2 Year</td><td>Yes</td><td> 2630</td><td>124</td><td>271</td></tr>
	<tr><th scope=row>2</th><td>Female</td><td>24</td><td>1</td><td>30</td><td>1</td><td>&lt; 1 Year</td><td>No </td><td>22144</td><td>152</td><td> 88</td></tr>
	<tr><th scope=row>3</th><td>Male  </td><td>42</td><td>1</td><td>29</td><td>0</td><td>1-2 Year</td><td>Yes</td><td>56222</td><td>156</td><td>108</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="nf">predict</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">xtest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Pour utiliser le F1_Score, nous faisons appel à la librairie <em>MLmetrics</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">F1_Score</span><span class="p">(</span><span class="n">y_true</span> <span class="o">=</span> <span class="n">dbr</span><span class="o">$</span><span class="n">Response</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">positive</span> <span class="o">=</span> <span class="m">1</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.329633366969391</div></div>
</div>
</div>
<div class="section" id="telechargement-des-donnees">
<h2>Téléchargement des données<a class="headerlink" href="#telechargement-des-donnees" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="nf">pd.read_csv</span><span class="p">(</span><span class="s">&quot;https://www.data.mclavier.com/prj_datascience/train_v1.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gender</th>
      <th>Age</th>
      <th>Driving_License</th>
      <th>Region_Code</th>
      <th>Previously_Insured</th>
      <th>Vehicle_Age</th>
      <th>Vehicle_Damage</th>
      <th>Annual_Premium</th>
      <th>Policy_Sales_Channel</th>
      <th>Vintage</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>30</td>
      <td>1</td>
      <td>28</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>26891</td>
      <td>3</td>
      <td>270</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>28</td>
      <td>1</td>
      <td>28</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>45434</td>
      <td>0</td>
      <td>146</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>32</td>
      <td>1</td>
      <td>47</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2630</td>
      <td>3</td>
      <td>195</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="pre-processing">
<h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<p>On sépare la variable à expliquer des variables explicatives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="nf">train.drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s">&#39;Response&#39;</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s">&#39;Response&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>On sépare les données en train et test.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span><span class="n">train_size</span> <span class="o">=</span> <span class="m">0.85</span><span class="p">)</span>

<span class="n">scaler</span><span class="o">=</span><span class="nf">StandardScaler</span><span class="p">()</span> 

<span class="n">X_scal_train</span> <span class="o">=</span> <span class="nf">scaler.fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_scal_test</span> <span class="o">=</span> <span class="nf">scaler.transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 

<span class="n">X_scal_train</span> <span class="o">=</span> <span class="nf">pd.DataFrame</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span><span class="n">index</span><span class="o">=</span> <span class="n">X_train.index</span><span class="p">)</span>
<span class="n">X_scal_test</span> <span class="o">=</span> <span class="nf">pd.DataFrame</span><span class="p">(</span><span class="n">X_scal_test</span><span class="p">,</span><span class="n">index</span><span class="o">=</span> <span class="n">X_test.index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="implementation">
<h2>Implémentation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>On fait un premier test avec les hyper-paramètres par défaut</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">()</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.38379160636758325
</pre></div>
</div>
<img alt="../../_images/44_rf_31_1.png" src="../../_images/44_rf_31_1.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="nf">cross_val_score</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s">&#39;f1&#39;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;F1 moyen de %0.2f avec un écart type de %0.2f&quot;</span> % <span class="p">(</span><span class="nf">scores.mean</span><span class="p">(),</span> <span class="nf">scores.std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1 moyen de 0.40 avec un écart type de 0.01
</pre></div>
</div>
</div>
</div>
<p>On fait aussi l’entrainement avec les variables normalisées pour voir si les résultats différents, mais ça ne semble pas être le cas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">()</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.4036962171527577
</pre></div>
</div>
<img alt="../../_images/44_rf_34_1.png" src="../../_images/44_rf_34_1.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1 moyen de 0.39 avec un écart type de 0.01
</pre></div>
</div>
</div>
</div>
<p>Afin d’avoir une meilleure compréhension de nos modèles nous pouvons aussi observer quelles sont les variables qui leurs apportent le plus d’informations et sont les plus importantes.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">importances</span> <span class="o">=</span> <span class="n">rfc.feature_importances_</span>
<span class="n">std</span> <span class="o">=</span> <span class="nf">np.std</span><span class="p">([</span><span class="n">tree.feature_importances_</span> <span class="n">for</span> <span class="n">tree</span> <span class="n">in</span> <span class="n">rfc.estimators_</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>

<span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="n">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">X.columns</span><span class="p">]</span>
<span class="n">forest_importances</span> <span class="o">=</span> <span class="nf">pd.Series</span><span class="p">(</span><span class="n">importances</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="nf">plt.subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>
<span class="nf">forest_importances.plot.bar</span><span class="p">(</span><span class="n">yerr</span><span class="o">=</span><span class="n">std</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="nf">ax.set_title</span><span class="p">(</span><span class="s">&quot;Feature importances&quot;</span><span class="p">)</span>
<span class="nf">ax.set_ylabel</span><span class="p">(</span><span class="s">&quot;Mean decrease in impurity&quot;</span><span class="p">)</span>
<span class="nf">fig.tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/44_rf_37_0.png" src="../../_images/44_rf_37_0.png" />
</div>
</div>
</div>
<div class="section" id="tuning">
<h2>Tuning<a class="headerlink" href="#tuning" title="Permalink to this headline">¶</a></h2>
<p>Il y’a de nombreux paramètres à tuner :</p>
<p>Nous allons intervenir sur les paramètres suivant et procéder dans l’ordre dans lesquels les paramètres sont présentés :</p>
<ul class="simple">
<li><p><strong>n_estimatorsint</strong>, default=100, ce paramètre correspond au nombre d’arbres, il est sans doute le plus important donc nous interviendrons deux fois dessus</p></li>
<li><p><strong>max_depthint</strong>, correspond à la profondeur maximale des arbres default=None</p></li>
<li><p><strong>min_samples_splitint</strong>, correspond au nombre de divergences nécessaire pour créer un nouveau noeud default=2</p></li>
<li><p><strong>min_samples_leafint</strong>, correspond au nombre minimum d’observations dans une feuille simple default=1</p></li>
<li><p><strong>min_impurity_decreasefloat</strong>, correspond à l’apport minimum d’une feuille pour qu’elle soit conservée default=0.0</p></li>
<li><p><strong>n_estimatorsint</strong>, le nombre d’arbre à nouveau, au cas où les paramètres modifiés modifient à leur tour le nombre d’arbre optimal, default=100</p></li>
<li><p><strong>max_features</strong>{“auto”, “sqrt”, “log2”}, default= “auto”, les 3 modes de calculs de features max qu’il faut tester</p></li>
<li><p><strong>class_weight</strong>{“balanced”, “balanced_subsample”}, default=None, les 2 options pour mettre des poids sur les observations</p></li>
</ul>
<div class="section" id="etape-1-initialisation">
<h3>Étape 1 : Initialisation<a class="headerlink" href="#etape-1-initialisation" title="Permalink to this headline">¶</a></h3>
<p>Rappelons, le F1 de base avant le tuning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">()</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.390286717378584
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="etape-2-n-estimators">
<h3>Étape 2 : n_estimators<a class="headerlink" href="#etape-2-n-estimators" title="Permalink to this headline">¶</a></h3>
<p>La méthode que nous allons utiliser pour le tuning est très simple nous allons tester des valeurs parmi une liste, gardant la meilleure valeur avant de répéter le processus avec les valeurs proches de l’optimum et en s’aidant de l’allure du graphe de nos F1 scores en fonction de nos paramètres pour savoir dans quelle direction s’orienter.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="m">100</span>

<span class="bp">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="m">50</span><span class="p">,</span><span class="m">60</span><span class="p">,</span><span class="m">70</span><span class="p">,</span><span class="m">75</span><span class="p">,</span><span class="m">80</span><span class="p">,</span><span class="m">90</span><span class="p">,</span><span class="m">95</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">105</span><span class="p">,</span><span class="m">110</span><span class="p">,</span><span class="m">120</span><span class="p">]</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">test</span><span class="o">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="o">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nf">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="nf">plt.plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">plt.show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>90 0.3939482106488216
</pre></div>
</div>
<img alt="../../_images/44_rf_44_1.png" src="../../_images/44_rf_44_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">n_estimators_int</span> <span class="o">=</span> <span class="n">kmaxi</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;Nous choisissons donc&quot;</span><span class="p">,</span><span class="n">kmaxi</span><span class="p">,</span><span class="s">&quot;comme la valeur pour le paramètre n_estimators.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nous choisissons donc 90 comme la valeur pour le paramètre n_estimators.
</pre></div>
</div>
</div>
</div>
<p>Nous n’observons pas de tendance sur le graphe donc nous pouvons nous arrêter. Nous aurions aussi pû essayer de regarder aux alentours de 100 s’il existait de meilleurs prétendants.</p>
</div>
<div class="section" id="etape-3-max-depth">
<h3>Étape 3 : max_depth<a class="headerlink" href="#etape-3-max-depth" title="Permalink to this headline">¶</a></h3>
<p>Nous répétons le processus pour ce paramètre, le bridant simplement à 100 maximum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="m">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="bp">T</span><span class="o">=</span><span class="p">[]</span>

<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="m">115</span><span class="p">,</span><span class="m">120</span><span class="p">,</span><span class="m">123</span><span class="p">,</span><span class="m">125</span><span class="p">,</span><span class="m">130</span><span class="p">]</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">test</span><span class="o">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="o">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nf">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="nf">plt.plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">plt.show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 0.38874383521903105
</pre></div>
</div>
<img alt="../../_images/44_rf_50_1.png" src="../../_images/44_rf_50_1.png" />
</div>
</div>
<p>Nous évaluons le f1-score actuellement.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">max_depth_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>

<span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span> <span class="o">=</span> <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.3807580174927114
</pre></div>
</div>
<img alt="../../_images/44_rf_52_1.png" src="../../_images/44_rf_52_1.png" />
</div>
</div>
</div>
<div class="section" id="etape-4-min-samples-split">
<h3>Étape 4 :min_samples_split<a class="headerlink" href="#etape-4-min-samples-split" title="Permalink to this headline">¶</a></h3>
<p>Nous répétons le processus pour le paramètre min_samples_split.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="bp">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">]</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">test</span><span class="o">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="o">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nf">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="nf">plt.plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">plt.show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 0.4165727170236754
</pre></div>
</div>
<img alt="../../_images/44_rf_55_1.png" src="../../_images/44_rf_55_1.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nous choisissons donc 3 comme la valeur du paramètre min_samples_split.
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>

<span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span> <span class="o">=</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.4060364464692483
</pre></div>
</div>
<img alt="../../_images/44_rf_57_1.png" src="../../_images/44_rf_57_1.png" />
</div>
</div>
</div>
<div class="section" id="etape-5-min-samples-leaf">
<h3>Étape 5 : min_samples_leaf<a class="headerlink" href="#etape-5-min-samples-leaf" title="Permalink to this headline">¶</a></h3>
<p>Nous répétons le processus pour le paramètre <em>min_samples_leaf</em>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="bp">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">]</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">test</span><span class="o">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="o">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nf">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="nf">plt.plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">plt.show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 0.4119148936170213
</pre></div>
</div>
<img alt="../../_images/44_rf_60_1.png" src="../../_images/44_rf_60_1.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nous choisissons donc 1 comme valeur du paramètre min_samples_leaf.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="etape-6-min-impurity-decrease">
<h3>Étape 6 : min_impurity_decrease<a class="headerlink" href="#etape-6-min-impurity-decrease" title="Permalink to this headline">¶</a></h3>
<p>Nous répétons le processus pour le paramètre <em>min_samples_leaf</em>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>

<span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.4146341463414634
</pre></div>
</div>
<img alt="../../_images/44_rf_64_1.png" src="../../_images/44_rf_64_1.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="bp">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="m">0.0001</span><span class="p">,</span><span class="m">0.001</span><span class="p">,</span><span class="m">0.05</span><span class="p">,</span><span class="m">0.1</span><span class="p">]</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">test</span><span class="o">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="o">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nf">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="nf">plt.plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">plt.show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 0.4146341463414634
</pre></div>
</div>
<img alt="../../_images/44_rf_65_1.png" src="../../_images/44_rf_65_1.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nous choisissons donc 0 comme valeur du paramètre min_impurity_decrease.
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="m">50</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.41870949563257254
</pre></div>
</div>
<img alt="../../_images/44_rf_67_1.png" src="../../_images/44_rf_67_1.png" />
</div>
</div>
</div>
<div class="section" id="etape-7-n-estimators">
<h3>Étape 7 : n_estimators<a class="headerlink" href="#etape-7-n-estimators" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="bp">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="m">50</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">,</span><span class="m">500</span><span class="p">]</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">test</span><span class="o">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="o">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nf">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="nf">plt.plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">plt.show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50 0.41897685052872247
</pre></div>
</div>
<img alt="../../_images/44_rf_69_1.png" src="../../_images/44_rf_69_1.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nous choisissons donc 50 comme valeur du paramètre n_estimators.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="etape-8-max-features">
<h3>Étape 8 : max_features<a class="headerlink" href="#etape-8-max-features" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;avec auto F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>

<span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;sqrt&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;avec sqrt F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>

<span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;avec log2 F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>avec auto F1= 0.4107496463932108
avec sqrt F1= 0.3988555078683834
avec log2 F1= 0.41231822070145424
</pre></div>
</div>
</div>
</div>
<p>On observe de meilleur résultat avec la valeur par défaut qui correspond au mode automatique donc nous le conservons dans notre tuning.</p>
<p><strong>log2</strong> semble meilleur :</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span><span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.4057724957555178
</pre></div>
</div>
<img alt="../../_images/44_rf_75_1.png" src="../../_images/44_rf_75_1.png" />
</div>
</div>
</div>
<div class="section" id="etape-9-class-weight">
<h3>Étape 9 : class_weight<a class="headerlink" href="#etape-9-class-weight" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;avec auto F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="s">&quot;balanced&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;avec balanced F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="s">&quot;balanced_subsample&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="s">&quot;avec balanced_subsample F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>avec auto F1= 0.4096247493554855
avec balanced F1= 0.43549712407559577
avec balanced_subsample F1= 0.43081081081081085
</pre></div>
</div>
</div>
</div>
<p>Nos résultats sont meilleurs avec l’option de balanced weight donc nous la conservons pour notre modèle.</p>
</div>
</div>
<div class="section" id="methode-par-algorithme-genetique">
<h2>Méthode par algorithme génétique<a class="headerlink" href="#methode-par-algorithme-genetique" title="Permalink to this headline">¶</a></h2>
<p>Afin d’améliorer notre tuning nous pouvons aussi utiliser des méthodes aléatoires, leur intérêt résside dans le fait qu’elles permettent des modifications plus subtiles ou au contraire plus imprévisibles et désorganisées que celles pensées par un humain ; et donc inexplorées.
Cette version est relativement naïve et ne possède que peu d’itération mais il est possible d’en faire une méthode beaucoup plus poussée, ce code est présent uniquement à titre d’exemple.</p>
<p>Le principe de base de la méthode aléatoire programmée est de partir de paramètres choisit à l’avance (ici ceux du tuning déterministe), paramètres “parents”, et de les modifier de manière aléatoire pour créer plusieurs enfants.
Une fois les enfants créé nous evaluons les enfants et les parents (via le F1 score ici) et on garde le meilleur, qui devient à son tour le parent de plusieurs enfant, permettant de réitérer le processus jusqu’à avoir un F1 score cible ou pendant une période temps donnée.</p>
<p>Par soucis de complexité temporelle, nous avons fait que 2 enfants par génération et nous n’avons fait tourner l’algorithme que quelques minutes mais il est recommandé de faire tourner l’algorithme plus longtemps avec plus d’enfants pour avoir de meilleurs résultats, même si cela peut durer plusieurs minutes/heures.</p>
<br>
<p>Nous avons aussi testé deux types de variations ne sachant laquelle choisir et n’ayant pas le temps de faire tourner les deux suffisamment longtemps :</p>
<ul class="simple">
<li><p>La première effectue de “relativement petit chocs” et entraine des variations qui vont de -50% à +50% sur un des paramètres</p></li>
<li><p>La deuxième entraîne des changements plus conséquents, un paramètre peut ainsi varier du simple au triple.
Ensuite comme expliqué plus tôt on choisit le meilleur entre les deux enfants et le parent avant de recommencer.</p></li>
</ul>
<br>
<p>Cliquer sur le + pour afficher les fonctions variations.</p>
<p><br><br><br><br><br></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">def</span> <span class="nf">variation</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">:</span>
    <span class="n">modif</span><span class="o">=</span><span class="nf">np.random.randint</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">modif</span><span class="o">==</span><span class="m">3</span><span class="o">:</span>
        <span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">*</span><span class="nf">np.random.uniform</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">1.5</span><span class="p">)</span><span class="o">+</span><span class="nf">np.random.uniform</span><span class="p">()</span><span class="o">/</span><span class="m">100</span>
    <span class="n">if</span> <span class="n">modif</span><span class="o">==</span><span class="m">0</span> <span class="n">or</span> <span class="n">modif</span><span class="o">==</span><span class="m">4</span><span class="o">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="nf">np.random.uniform</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">1.5</span><span class="p">))</span><span class="m">+1</span>
    <span class="n">else</span><span class="o">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="nf">np.random.uniform</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">1.5</span><span class="p">)</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s">&quot;balanced&quot;</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>


<span class="n">def</span> <span class="nf">variation2</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">:</span>
    <span class="n">modif</span><span class="o">=</span><span class="nf">np.random.randint</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">modif</span><span class="o">==</span><span class="m">3</span><span class="o">:</span>
        <span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">*</span><span class="nf">np.random.uniform</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">)</span><span class="o">+</span><span class="nf">np.random.uniform</span><span class="p">()</span><span class="o">/</span><span class="m">100</span>
    <span class="n">if</span> <span class="n">modif</span><span class="o">==</span><span class="m">0</span> <span class="n">or</span> <span class="n">modif</span><span class="o">==</span><span class="m">4</span><span class="o">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="nf">np.random.uniform</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">5</span><span class="p">))</span><span class="m">+1</span>
    <span class="n">else</span><span class="o">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="nf">np.random.uniform</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="m">1.5</span><span class="p">)</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">1</span><span class="p">],</span>
                            <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">],</span>
                            <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s">&quot;balanced&quot;</span><span class="p">)</span>
    <span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="nf">return</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_depth_int</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="n">min_impurity_decrease_int</span><span class="p">,</span><span class="n">n_estimators_int</span><span class="p">];</span> <span class="n">param</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[100, 0.5, 0.25, 0, 50]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="bp">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">rip</span><span class="o">=</span><span class="m">0</span>

<span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s">&quot;balanced&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">for</span> <span class="n">k</span> <span class="n">in</span> <span class="nf">range</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="o">:</span> <span class="c1">#ou 100 voir 2000 pendant la nuit</span>
    <span class="n">rip</span><span class="o">=</span><span class="n">rip</span><span class="m">+1</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">nparam</span><span class="p">,</span><span class="n">nF</span><span class="o">=</span><span class="nf">variation</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">nF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">nF</span><span class="o">&gt;</span><span class="n">newF</span><span class="o">:</span>
        <span class="n">newF</span><span class="o">=</span><span class="n">nF</span>
        <span class="n">param</span><span class="o">=</span><span class="n">nparam</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">&quot;+ Improvement&quot;</span><span class="p">)</span>
        <span class="n">rip</span><span class="o">=</span><span class="m">0</span>
    <span class="n">nparam</span><span class="p">,</span><span class="n">nF</span><span class="o">=</span><span class="nf">variation2</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="nf">T.append</span><span class="p">(</span><span class="n">nF</span><span class="p">)</span>
    <span class="n">if</span> <span class="n">nF</span><span class="o">&gt;</span><span class="n">newF</span><span class="o">:</span>
        <span class="n">newF</span><span class="o">=</span><span class="n">nF</span>
        <span class="n">param</span><span class="o">=</span><span class="n">nparam</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">&quot;+ Improvement&quot;</span><span class="p">)</span>
        <span class="n">rip</span><span class="o">=</span><span class="m">0</span>
    <span class="n">if</span> <span class="n">rip</span><span class="o">==</span><span class="m">100</span><span class="o">:</span>
        <span class="n">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../../_images/44_rf_86_0.png" src="../../_images/44_rf_86_0.png" />
</div>
</div>
<p>Paramètres obtenus :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[947, 0.11959494750571721, 0.08048576405844253, 0.030792701550521537, 88]
</pre></div>
</div>
</div>
</div>
<p>Au final après avoir fait tourner l’algorithme on obtient :</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="nf">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s">&quot;balanced&quot;</span><span class="p">)</span>
<span class="nf">rfc.fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="nf">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1 moyen de 0.55 avec un écart type de 0.01
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il est important de noter que si vous faites tourner cet algorithme de votre côté vous n’obtiendrez pas forcément les mêmes résultats, il peuvent être meilleurs ou moins bons…</p>
</div>
<p><br><br><br><br><br></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./docs\4_modeles"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="43_cart.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">CART</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="45_rn.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Neuronal Network</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By BÉRU Théodore, CHEBAK Soraya, CLAVIER Mathieu, GUICHARD Victor<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>