
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Random Forest &#8212; G1 - Apprentissage statistique</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Réseau de neurones" href="45_rn.html" />
    <link rel="prev" title="CART" href="43_cart.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">G1 - Apprentissage statistique</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1_desc/10_description.html">
   Description des données
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2_prep/20_generale.html">
   Préparation des données
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_mesure/30_mesure.html">
   Mesure
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="40_modeles.html">
   Implémentation des modèles
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="41_logistique.html">
     Logistique
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="42_svc.html">
     Support Vector Classifier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="43_cart.html">
     CART
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Random Forest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="45_rn.html">
     Réseau de neurones
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="46_grad_boost.html">
     Gradient Boosting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="47_xgboost.html">
     XGBoost
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../5_retenu/50_mod_final.html">
   Modèle finale
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Random Forest
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-processing">
   Pre-processing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tuning">
     Tuning
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#il-y-a-de-nombreux-parametres-a-tuner">
     Il y’a de nombreux paramêtres à tuner :
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nous-allons-intervenir-sur-les-parametres-suivant-et-proceder-dans-l-ordre-dans-lesquels-les-parametres-sont-presentes">
       Nous allons intervenir sur les paramêtres suivant et procéder dans l’ordre dans lesquels les paramêtres sont présentés
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#on-reprend-tout-d-abord-le-resultat-de-base-avant-de-commencer-notre-tuning">
         On reprend tout d’abord le résultat de base avant de commencer notre tuning
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#n-estimators">
   n_estimators
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#max-depth">
   Max depth
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#min-samples-split">
   min_samples_split
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#min-samples-leaf">
   min_samples_leaf
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#min-impurity-decrease">
   min_impurity_decrease
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   n_estimators
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#max-features-auto-sqrt-log2-default-auto">
   max_features{“auto”, “sqrt”, “log2”}, default= “auto”
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#log2-semble-meilleur">
     log2 semble meilleur
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#class-weight-balanced-balanced-subsample-default-none">
   class_weight{“balanced”, “balanced_subsample”}, default=None
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#methode-tatonement-aleatoire">
   Méthode tatonement aléatoire
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="random-forest">
<h1>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this headline">¶</a></h1>
<p>D’abord nous importons toutes les librairies nécessaire à l’implémentation de la méthode sous python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>Nous créons aussi deux fonctions utile pour l’évaluation de nos modèles et nous téléchargeons les données sur lesquels nous devons travailler.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">F1</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">Y_model</span> <span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">f1_scor</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">Y_model</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">f1_scor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">result_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">Y_model</span> <span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">f1_scor</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">Y_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Le f1 score vaut&#39;</span><span class="p">,</span><span class="n">f1_scor</span><span class="p">)</span>
    
<span class="c1">#     score = cross_val_score(model,X,Y,cv=5,scoring = make_scorer(f1_score))</span>
<span class="c1">#     print(&#39;F1 cross validé :&#39;, np.mean(score))</span>
    
   <span class="c1"># Matrice de confusion</span>
    <span class="n">cm_model</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y_model</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_model</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># return()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://www.data.mclavier.com/prj_datascience/train_v1.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gender</th>
      <th>Age</th>
      <th>Driving_License</th>
      <th>Region_Code</th>
      <th>Previously_Insured</th>
      <th>Vehicle_Age</th>
      <th>Vehicle_Damage</th>
      <th>Annual_Premium</th>
      <th>Policy_Sales_Channel</th>
      <th>Vintage</th>
      <th>Response</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>30</td>
      <td>1</td>
      <td>28</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>26891</td>
      <td>3</td>
      <td>270</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>28</td>
      <td>1</td>
      <td>28</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>45434</td>
      <td>0</td>
      <td>146</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>32</td>
      <td>1</td>
      <td>47</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2630</td>
      <td>3</td>
      <td>195</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>54</td>
      <td>1</td>
      <td>28</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>41420</td>
      <td>1</td>
      <td>121</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>45</td>
      <td>1</td>
      <td>36</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>32764</td>
      <td>2</td>
      <td>185</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="pre-processing">
<h1>Pre-processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h1>
<p>On sépare la variable à expliquer des variables explicatives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variables explicative</span>
<span class="n">exp_var</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Décomposition features / target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">exp_var</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Response&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gender</th>
      <th>Age</th>
      <th>Driving_License</th>
      <th>Region_Code</th>
      <th>Previously_Insured</th>
      <th>Vehicle_Age</th>
      <th>Vehicle_Damage</th>
      <th>Annual_Premium</th>
      <th>Policy_Sales_Channel</th>
      <th>Vintage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>30</td>
      <td>1</td>
      <td>28</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>26891</td>
      <td>3</td>
      <td>270</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>28</td>
      <td>1</td>
      <td>28</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>45434</td>
      <td>0</td>
      <td>146</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>32</td>
      <td>1</td>
      <td>47</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2630</td>
      <td>3</td>
      <td>195</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>54</td>
      <td>1</td>
      <td>28</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>41420</td>
      <td>1</td>
      <td>121</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>45</td>
      <td>1</td>
      <td>36</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>32764</td>
      <td>2</td>
      <td>185</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>On sépare les données en train et test puis on les scale avec les méthodes de sklearn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span><span class="n">train_size</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">)</span>

<span class="n">scaler</span><span class="o">=</span><span class="n">StandardScaler</span><span class="p">()</span> 

<span class="n">X_scal_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_scal_test</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 

<span class="n">X_scal_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span><span class="n">index</span><span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">exp_var</span><span class="p">)</span>
<span class="n">X_scal_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_scal_test</span><span class="p">,</span><span class="n">index</span><span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">exp_var</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>On fait un premier test avec les hyper-paramêtres par défaut</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.379754242246928
</pre></div>
</div>
<img alt="../../_images/44_rf_15_1.png" src="../../_images/44_rf_15_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.39772139, 0.38788193, 0.40021036, 0.40639505, 0.39623601])
</pre></div>
</div>
</div>
</div>
<p>On fait aussi l’entrainement avec les variables normalisées pour voir si les résultats différents, mais ça ne semble pas être le cas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.40069384215091064
</pre></div>
</div>
<img alt="../../_images/44_rf_18_1.png" src="../../_images/44_rf_18_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.39623135, 0.3870801 , 0.39978986, 0.4083442 , 0.39113827])
</pre></div>
</div>
</div>
</div>
<p>Afin d’avoir une meilleur compréhension de nos modèle on peut aussi observer quels sont les variables qui leurs apportent le plus d’informations et sont les plus importantes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">importances</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">rfc</span><span class="o">.</span><span class="n">estimators_</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">forest_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">importances</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">forest_importances</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">yerr</span><span class="o">=</span><span class="n">std</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Feature importances&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean decrease in impurity&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/44_rf_21_0.png" src="../../_images/44_rf_21_0.png" />
</div>
</div>
<div class="section" id="tuning">
<h2>Tuning<a class="headerlink" href="#tuning" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="il-y-a-de-nombreux-parametres-a-tuner">
<h2>Il y’a de nombreux paramêtres à tuner :<a class="headerlink" href="#il-y-a-de-nombreux-parametres-a-tuner" title="Permalink to this headline">¶</a></h2>
<div class="section" id="nous-allons-intervenir-sur-les-parametres-suivant-et-proceder-dans-l-ordre-dans-lesquels-les-parametres-sont-presentes">
<h3>Nous allons intervenir sur les paramêtres suivant et procéder dans l’ordre dans lesquels les paramêtres sont présentés<a class="headerlink" href="#nous-allons-intervenir-sur-les-parametres-suivant-et-proceder-dans-l-ordre-dans-lesquels-les-parametres-sont-presentes" title="Permalink to this headline">¶</a></h3>
<p>n_estimatorsint, default=100, ce paramêtre correspond au nombre d’arbre, il est sans doute le plus important donc nous interviendrons deux fois dessus</p>
<p>max_depthint, correspond à la profondeur maximal des arbres default=None</p>
<p>min_samples_splitint, correspond au nombre de divergences nécessaire pour créer un nouveau noeud default=2</p>
<p>min_samples_leafint, correspond au nombre minimum d’observations dans une feuille simple default=1</p>
<p>min_impurity_decreasefloat, correspond à l’apport minimum d’une fuille pour qu’elle soit conservé default=0.0</p>
<p>n_estimatorsint, le nombre d’arbre à nouveau, au cas où les paramêtres modifiés modifié à leur tour le nombre d’arbre optimal, default=100</p>
<p>max_features{“auto”, “sqrt”, “log2”}, default= “auto”, les 3 modes de calculs de features max qu’il faut tester</p>
<p>class_weight{“balanced”, “balanced_subsample”}, default=None, les 2 options pour mettre des poids sur les observations</p>
<div class="section" id="on-reprend-tout-d-abord-le-resultat-de-base-avant-de-commencer-notre-tuning">
<h4>On reprend tout d’abord le résultat de base avant de commencer notre tuning<a class="headerlink" href="#on-reprend-tout-d-abord-le-resultat-de-base-avant-de-commencer-notre-tuning" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.3884176659842059
</pre></div>
</div>
<img alt="../../_images/44_rf_25_1.png" src="../../_images/44_rf_25_1.png" />
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="n-estimators">
<h1>n_estimators<a class="headerlink" href="#n-estimators" title="Permalink to this headline">¶</a></h1>
<p>La méthode que nous allons utiliser pour le tuning est très simple nous allons tester des valeurs parmi une liste, gardans la meilleur valeur avant de répéter le processus à avec les valeurs proches de l’optimum et en s’aidant de l’allure du graphe de nos F1 scores en fonction de nos paramêtre pour savoir dans quelle directions s’orienter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxi</span><span class="o">=</span><span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="c1">#test=[50,75,100,115,120,130,200]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">120</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="p">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 0.4046043165467626
</pre></div>
</div>
<img alt="../../_images/44_rf_28_1.png" src="../../_images/44_rf_28_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_estimators_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;on choissit donc&quot;</span><span class="p">,</span><span class="n">kmaxi</span><span class="p">,</span><span class="s2">&quot;comme la valeur pour&quot;</span><span class="p">,</span><span class="s2">&quot;n_estimators_int&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>on choissit donc 100 comme la valeur pour n_estimators_int
</pre></div>
</div>
</div>
</div>
<p>Nous n’observons pas de tendances sur le graphe donc nous pouvons nous arréter là, mais nous aurions aussi pû essayer de regarder aux alentours de 100 s’il y’avait de meilleurs prétendants.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="max-depth">
<h1>Max depth<a class="headerlink" href="#max-depth" title="Permalink to this headline">¶</a></h1>
<p>Nous répétons le processus pour ce paramêtre, le bridant simplement à 100 maximum</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxi</span><span class="o">=</span><span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="c1">#test=[1,5,10,20,100]</span>
<span class="c1">#test=[20,100,200]</span>
<span class="c1">#test=[70,90,95,100,105,110]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="mi">115</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">130</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="p">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>130 0.40566310314937876
</pre></div>
</div>
<img alt="../../_images/44_rf_33_1.png" src="../../_images/44_rf_33_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_depth_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.3929601846508944
</pre></div>
</div>
<img alt="../../_images/44_rf_34_1.png" src="../../_images/44_rf_34_1.png" />
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="min-samples-split">
<h1>min_samples_split<a class="headerlink" href="#min-samples-split" title="Permalink to this headline">¶</a></h1>
<p>Nous répétons le processus pour ce paramêtre.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="p">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 0.40553792904528413
</pre></div>
</div>
<img alt="../../_images/44_rf_36_1.png" src="../../_images/44_rf_36_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_samples_split_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;on choissit donc&quot;</span><span class="p">,</span><span class="n">kmaxi</span><span class="p">,</span><span class="s2">&quot;comme la valeur pour&quot;</span><span class="p">,</span><span class="s2">&quot;min_samples_split_int&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>on choissit donc 3 comme la valeur pour min_samples_split_int
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span><span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.39999999999999997
</pre></div>
</div>
<img alt="../../_images/44_rf_38_1.png" src="../../_images/44_rf_38_1.png" />
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="min-samples-leaf">
<h1>min_samples_leaf<a class="headerlink" href="#min-samples-leaf" title="Permalink to this headline">¶</a></h1>
<p>Nous répétons le processus pour ce paramêtre.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="p">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 0.4024496937882765
</pre></div>
</div>
<img alt="../../_images/44_rf_40_1.png" src="../../_images/44_rf_40_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_samples_leaf_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;on choissit donc&quot;</span><span class="p">,</span><span class="n">kmaxi</span><span class="p">,</span><span class="s2">&quot;comme la valeur pour&quot;</span><span class="p">,</span><span class="s2">&quot;min_samples_leaf_int&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>on choissit donc 1 comme la valeur pour min_samples_leaf_int
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="min-impurity-decrease">
<h1>min_impurity_decrease<a class="headerlink" href="#min-impurity-decrease" title="Permalink to this headline">¶</a></h1>
<p>Nous répétons le processus pour ce paramêtre</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span><span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.406041243101946
</pre></div>
</div>
<img alt="../../_images/44_rf_43_1.png" src="../../_images/44_rf_43_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="p">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 0.406041243101946
</pre></div>
</div>
<img alt="../../_images/44_rf_44_1.png" src="../../_images/44_rf_44_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_impurity_decrease_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;on choissit donc&quot;</span><span class="p">,</span><span class="n">kmaxi</span><span class="p">,</span><span class="s2">&quot;comme la valeur pour&quot;</span><span class="p">,</span><span class="s2">&quot;min_impurity_decrease_int&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>on choissit donc 0 comme la valeur pour min_impurity_decrease_int
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span><span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">kmaxi</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.39976891969959566
</pre></div>
</div>
<img alt="../../_images/44_rf_46_1.png" src="../../_images/44_rf_46_1.png" />
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1>n_estimators<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">test</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">500</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newF</span><span class="o">&gt;</span><span class="n">maxi</span><span class="p">:</span>
        <span class="n">maxi</span><span class="o">=</span><span class="n">newF</span>
        <span class="n">kmaxi</span><span class="o">=</span><span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmaxi</span><span class="p">,</span><span class="n">maxi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 0.41077055285018615
</pre></div>
</div>
<img alt="../../_images/44_rf_48_1.png" src="../../_images/44_rf_48_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_estimators_int</span><span class="o">=</span><span class="n">kmaxi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;on choissit donc&quot;</span><span class="p">,</span><span class="n">kmaxi</span><span class="p">,</span><span class="s2">&quot;comme la valeur pour&quot;</span><span class="p">,</span><span class="s2">&quot;n_estimators_int&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>on choissit donc 100 comme la valeur pour n_estimators_int
</pre></div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="max-features-auto-sqrt-log2-default-auto">
<h1>max_features{“auto”, “sqrt”, “log2”}, default= “auto”<a class="headerlink" href="#max-features-auto-sqrt-log2-default-auto" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avec auto F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avec sqrt F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">Xl_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avec log2 F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>avec auto F1= 0.4009256580850449
avec sqrt F1= 0.3924746743849494
avec log2 F1= 0.40011547344110854
</pre></div>
</div>
</div>
</div>
<p>On observe de meilleur résultat avec la valeur par défaut qui correspond au mode automatique donc nous le conservons dans notre tuning.</p>
<div class="section" id="log2-semble-meilleur">
<h2>log2 semble meilleur<a class="headerlink" href="#log2-semble-meilleur" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_rfc</span> <span class="o">=</span> <span class="n">result_model</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="n">maxi</span><span class="o">=</span><span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le f1 score vaut 0.3982758620689655
</pre></div>
</div>
<img alt="../../_images/44_rf_54_1.png" src="../../_images/44_rf_54_1.png" />
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="class-weight-balanced-balanced-subsample-default-none">
<h1>class_weight{“balanced”, “balanced_subsample”}, default=None<a class="headerlink" href="#class-weight-balanced-balanced-subsample-default-none" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avec auto F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avec balanced F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth_int</span><span class="p">,</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split_int</span><span class="p">,</span><span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf_int</span><span class="p">,</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators_int</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span>
                            <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced_subsample&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;avec balanced_subsample F1=&quot;</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>avec auto F1= 0.40242844752818735
avec balanced F1= 0.42964196502914237
avec balanced_subsample F1= 0.41696700859439983
</pre></div>
</div>
</div>
</div>
<p>nos résultats sont meilleurs avec l’option de balanced weight donc nous la conservons pour notre modèle.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="methode-tatonement-aleatoire">
<h1>Méthode tatonement aléatoire<a class="headerlink" href="#methode-tatonement-aleatoire" title="Permalink to this headline">¶</a></h1>
<p>Afin d’améliorer notre tuning nous pouvons aussi utilisés des méthodes aléatoires, leurs intérêts résside dans le fait qu’elle permettents des modifications plus subtil ou au contraire plus imprévisible et désorganisé que celle pensé par un humain, et donc inexploré.
Cette version est relativement naive et ne  possède que peu d’itération mais il est possible d’en faire une méthode beaucoup plus poussé, ce code est présent uniquement à titre d’exemple.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">variation</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
    <span class="n">modif</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">modif</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">modif</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">modif</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">variation2</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
    <span class="n">modif</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">modif</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">modif</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">modif</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="n">modif</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
    <span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">newF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">max_depth_int</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="n">min_impurity_decrease_int</span><span class="p">,</span><span class="n">n_estimators_int</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[130, 0.5, 0.25, 0, 100]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">=</span><span class="p">[]</span>
<span class="n">rip</span><span class="o">=</span><span class="mi">0</span>
<span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">max_depth_int</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="n">min_impurity_decrease_int</span><span class="p">,</span><span class="n">n_estimators_int</span><span class="p">]</span>
<span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> <span class="c1">#ou 100 voir 2000 pendant la nuit</span>
    <span class="n">rip</span><span class="o">=</span><span class="n">rip</span><span class="o">+</span><span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">nparam</span><span class="p">,</span><span class="n">nF</span><span class="o">=</span><span class="n">variation</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nF</span><span class="o">&gt;</span><span class="n">newF</span><span class="p">:</span>
        <span class="n">newF</span><span class="o">=</span><span class="n">nF</span>
        <span class="n">param</span><span class="o">=</span><span class="n">nparam</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;evolution !!!!!&quot;</span><span class="p">)</span>
        <span class="n">rip</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">nparam</span><span class="p">,</span><span class="n">nF</span><span class="o">=</span><span class="n">variation2</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nF</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nF</span><span class="o">&gt;</span><span class="n">newF</span><span class="p">:</span>
        <span class="n">newF</span><span class="o">=</span><span class="n">nF</span>
        <span class="n">param</span><span class="o">=</span><span class="n">nparam</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;evolution !!!!!&quot;</span><span class="p">)</span>
        <span class="n">rip</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">if</span> <span class="n">rip</span><span class="o">==</span><span class="mi">100</span><span class="p">:</span>
        <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
1
evolution !!!!!
evolution !!!!!
2
3
4
evolution !!!!!
5
6
7
8
9
[462, 0.6809890717276842, 0.13160002688359748, 0.20373012035970045, 529]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1c3802a3a60&gt;]
</pre></div>
</div>
<img alt="../../_images/44_rf_62_2.png" src="../../_images/44_rf_62_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[462, 0.6809890717276842, 0.13160002688359748, 0.20373012035970045, 529]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1c3d69f53a0&gt;]
</pre></div>
</div>
<img alt="../../_images/44_rf_63_2.png" src="../../_images/44_rf_63_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;log2&quot;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Au final le F1 score que nous obtenons est relativement correct sur cette base de test avec un résultat de 0.35 environ</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newF</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.342216941096588
</pre></div>
</div>
</div>
</div>
<p>Afin d’avoir une meilleur vision sur notre modèle dans un cas plus généralnous pouvons effectuer une cross validation qui prends plus de variété dans ses tests et évalutation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 moyen de </span><span class="si">%0.2f</span><span class="s2"> avec un écart type de </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1 moyen de 0.20 avec un écart type de 0.17
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">min_samples_split</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">n_estimators</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scal_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">newF</span><span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X_scal_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">rfc</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 moyen de </span><span class="si">%0.2f</span><span class="s2"> avec un écart type de </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1 moyen de 0.20 avec un écart type de 0.17
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs\4_modeles"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="43_cart.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">CART</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="45_rn.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Réseau de neurones</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By BÉRU Théodore, CHEBAK Soraya, CLAVIER Mathieu, GUICHARD Victor<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>